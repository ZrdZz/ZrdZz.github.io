---
layout:     post
title:      Grunt基础
date:       2017-09-28
author:     zrd
catalog:    true
tags:
    - Grunt
---

## Grunt中的基本概念：Task、Options、Target

Grunt把代码压缩、目录清除、创建目录等操作称为Task，并将所有Task放在`grunt.initConfig()`，例

```
grunt.initConfig({
  config: config,    //常量，后面会通过`<%=...%>`加以引用
  
  watch: {
    options:{},      //Options，为Task或Target的配置项
    
    targetName{}     //Target
  }
})
```
Grunt加载Task可以使用`load-grunt-tasks`插件，它会自动将`paskage.json`中声明的Task加载进来，也可以手动安装Task插件，例`npm install grunt-contrib-copy --save-dev`

想运行某个Task时执行`grunt TaskName`,想运行某个Task中的Target时执行`grunt TaskName:TargetName`

可以通过`grunt.registerTask(组合名/default，Array/Function)`组合Task一起执行,通过`grunt 组合名`执行，若不加组合名，则执行默认的组合(default)

## 构建一个Grunt项目

### 文件结构
   
- grunt
  - app
    - index.html
    - index.js
  - node_modules
  - Gruntfile.js
  - package.json

### 创建步骤

- 创建项目文件，在里面创建index.html、index.js
- 执行`npm init`创建package.json文件
- 执行`npm install grunt --save-dev`                //会将grunt添加到devDependencies(开发环境)
- 安装Grunt插件`npm install load-grunt-tasks --save-dev`，他会自动加载Task
- 创建Gruntfile.js文件并编写

### 编写Gruntfile.js示例

```
'use strict'

moudle.export = function(grunt){
  require('load-grunt-tasks')(grunt);
  
  require('time-grunt')(grunt);
  
  var config = {
    app: 'app',
    dist: 'dist'
  }
  
  grunt.initConfig({
    config: config,
    
    copy：{
      dist: {
        
      }
    }
  })
}
```
一共有三种从源文件到目标文件的映射方式：(额外参数只适用于1,3)
1. Compact Format

```
  copy: {                                              //Task
    dist_html: {                                       //Target
      src: '<%= config.app %>/index.html',             //源文件,可以是数组或字符串
      dest: '<%= config.dist %>/index.html',           //目标文件
    },
    dist_js: {                                         //Target
      src: '<%= config.app %>/js/index.js',            //源文件,可以是数组或字符串
      dest: '<%= config.dist %>/js/index.js'           //目标文件
    }
  },
  
  clean: {
    dist: {
      src: '<%= config.dist %>/**/*',
      filter: 'isFile' ,                                //可以是`stats`下的函数名，如`isFile()`,这样删除时会保留js文件夹，也可以自己制定函数
      dot: true ,                                       //会选中以点开头的文件
      expand: true                                      //动态处理src到dest的文件映射
    }
  }
 ```
 
 2. Files Object Format
 
 ```
    copy: {                                          
     dist: { 
       files: {
         '<%= config.dist %>/index.html': '<%= config.app %>/index.html', 
         '<%= config.dist %>/js/index.js': '<%= config.app %>/js/index.js',          //value也可以是数组
       }
     },
   }
 ```
 
 3. File Array Format
 
 ```
   copy: {                                          
     dist: { 
       files: [
         {
           expand: true,
           cwd: '<%= config.app %>/',                  //相对于src的寻路路径,注意后面的路径分隔符
           src: '*.html',
           dest: '<%= config.dist %>/',
           ext: '.min.html',                           //修改文件后缀名，生成index.min.html
           extDot: 'first',                            //从哪里修改文件后缀名
           flatten: true,                              //复制时会直接去掉中间的目录
           rename: function(dest, src){                //在ext、extDot、flatten执行后调用
                     return dest + 'js/' + src;
                   }                      
         },
         { 
           src: '<%= config.app %>/js/index.js',         
           dest: '<%= config.dist %>/js/index.js'           
         }
       ]
     },
   }
 ```

